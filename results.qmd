# Results

```{r, echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE}
if (!require("writexl")) install.packages("writexl")
if (!require("ggplot2")) install.packages("ggplot2")
library(ggplot2)
library(readxl)
library(dplyr)
library(scales)
library(writexl)

# Load the Excel file
file_path <- "./data/SOWC-2023-Statistical-tables-All-EN.xlsx"

# Get the names of all sheets
sheet_names <- excel_sheets(file_path)

# Function to calculate mode
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Function to preprocess a single sheet
preprocess_sheet <- function(sheet_name) {
  df <- read_excel(file_path, sheet = sheet_name)

  # Handling missing values: Fill numeric missing values with median and categorical with mode
  df <- df %>% mutate(across(where(is.numeric), ~ifelse(is.na(.), median(., na.rm = TRUE), .)))
  df <- df %>% mutate(across(where(is.factor), ~ifelse(is.na(.), Mode(.), .)))

  # Normalization: Apply Min-Max scaling to numeric columns
  df <- df %>% mutate(across(where(is.numeric), ~rescale(., to = c(0, 1))))

  return(df)
}

# Apply preprocessing to all sheets and store in a named list
preprocessed_data <- setNames(object = lapply(sheet_names, preprocess_sheet),
                              nm = sheet_names)

# Define the path for the new Excel file
# new_file_path <- "./data/Preprocessed_SOWC-2023-Statistical-tables-All-EN.xlsx"

# Write each preprocessed data frame to a new Excel file
# write_xlsx(preprocessed_data, path = new_file_path, col_names = TRUE)

# Confirmation message
# cat("Preprocessed data saved to", new_file_path)
```

## Analysis of Overweight Percentages in 2020


```{r, echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE}
library(ggplot2)
library(dplyr)
library(readr)
library(tidyverse)

# Load the data
nutrition_data <- read_csv("./data/Nutrition.csv")

# Clean the column names to remove excess periods and line breaks
colnames(nutrition_data) <- gsub("\\.\\n|\\.{2,}", "", colnames(nutrition_data))
colnames(nutrition_data) <- gsub("\\s+", " ", colnames(nutrition_data))

# Convert 'Overweight (%) (2020)' to numeric, remove NAs
nutrition_data <- nutrition_data %>%
  mutate(Overweight_2020 = as.numeric(`Overweight (%) (2020)`)) %>%
  drop_na(Overweight_2020) %>%
  arrange(desc(Overweight_2020))

# Calculate the number of rows for the top 10%
top_10_percent_rows <- round(nrow(nutrition_data) * 0.1)

# Get the top 10% of the data
top_10_percent <- nutrition_data %>%
  slice_max(order_by = Overweight_2020, n = top_10_percent_rows)

# Create the bar chart with different colors for each country
ggplot(top_10_percent, aes(x = reorder(`Countries and areas`, Overweight_2020), y = Overweight_2020, fill = `Countries and areas`)) +
  geom_bar(stat = "identity") +
  scale_fill_viridis_d() +  # Use Viridis color scale for distinct colors
  coord_flip() +  # Flip coordinates for a horizontal bar chart
  labs(x = "Countries", y = "Overweight (%)", title = "Top 10% Overweight Percentage by Country in 2020") +
  theme_minimal() +
  theme(axis.text.y = element_text(angle = 45, hjust = 1), legend.position = "none")  # Adjust the text angle for country names and remove legend


```

The bar chart above illustrates the top 10% of countries with the highest percentages of overweight individuals in the year 2020. This visualization helps in identifying the countries that are facing the most significant challenges related to overweight populations. Notably, Libya tops the chart, followed by Lebanon and Australia, indicating a need for targeted public health interventions in these areas. The variation in color for each country enhances the chart's readability and allows for quick comparison across the countries listed. Such data is crucial for policymakers and health professionals who are working to combat obesity and promote healthier lifestyles.


